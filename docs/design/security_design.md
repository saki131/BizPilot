# セキュリティ設計書

## 1. セキュリティ概要
システムはJWT認証とHTTPS通信を基本とし、XSS、CSRF、SQLインジェクション等の攻撃から保護します。

## 2. 認証・認可
### JWT認証
- **アクセストークン**: 15分有効
- **リフレッシュトークン**: 7日有効
- **セキュアストレージ**: HttpOnly Cookieまたはローカルストレージ
- **自動更新**: アクセストークン有効期限切れ時にリフレッシュ

### パスワードセキュリティ
- **ハッシュ化**: bcrypt (salt rounds: 12)
- **最小要件**: 8文字以上、大文字小文字数字記号混在
- **ブルートフォース対策**: ログイン失敗回数制限 (5回/15分)

## 3. 通信セキュリティ
### HTTPS
- **必須**: 全通信でHTTPSを使用
- **証明書**: Let's Encrypt (自動更新)
- **HSTS**: Strict-Transport-Securityヘッダー

### CORS
- **許可オリジン**: フロントエンドドメインのみ
- **許可メソッド**: GET, POST, PUT, DELETE
- **許可ヘッダー**: Content-Type, Authorization

## 4. アプリケーションセキュリティ
### XSS対策
- **入力サニタイズ**: DOMPurify使用
- **CSP**: Content Security Policyヘッダー
- **出力エンコード**: HTMLエンティティエンコード

### CSRF対策
- **SameSite Cookie**: Strict設定
- **トークン検証**: POST/PUT/DELETEでCSRFトークン検証

### SQLインジェクション対策
- **ORM使用**: SQLAlchemyでパラメータ化クエリ
- **入力バリデーション**: Pydanticスキーマ検証

## 5. データセキュリティ
### 機密情報管理
- **環境変数**: APIキー、パスワード等の機密情報
- **暗号化**: 必要に応じてAES暗号化
- **ログ**: 機密情報除外

### データ保護
- **バックアップ**: 毎日自動バックアップ
- **暗号化**: データベース暗号化
- **アクセス制御**: 最小権限の原則

## 6. インフラセキュリティ
### クラウドセキュリティ
- **Vercel**: 自動セキュリティ更新
- **Fly.io**: コンテナセキュリティ
- **Supabase**: PostgreSQLセキュリティ

### 監視・ログ
- **アクセスログ**: 全APIアクセス記録
- **エラーログ**: セキュリティイベント監視
- **アラート**: 不審アクセス検知

## 7. 脆弱性管理
### 定期スキャン
- **依存関係**: npm audit, safety (Python)
- **コードスキャン**: ESLintセキュリティルール, bandit
- **ペネトレーションテスト**: リリース前実施

### 更新管理
- **自動更新**: セキュリティパッチの自動適用
- **バージョン管理**: 脆弱性のあるライブラリ使用禁止

## 8. インシデント対応
### 対応フロー
1. 検知
2. 評価
3. 隔離
4. 回復
5. 報告
6. 改善

### 連絡先
- **セキュリティ担当者**: システム管理者
- **報告先**: 開発チーム、経営層
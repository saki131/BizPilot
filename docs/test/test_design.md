# テスト設計書

## 1. テスト概要
システムの品質を確保するため、単体テスト、統合テスト、E2Eテストを実施します。

## 2. テスト戦略

### テストレベル
- **単体テスト**: 各コンポーネントの機能テスト
- **統合テスト**: API連携、データベース連携テスト
- **E2Eテスト**: ユーザーシナリオの完全テスト
- **パフォーマンステスト**: 負荷テスト、応答時間テスト

### テスト範囲
- **機能テスト**: 要件定義書の全機能
- **非機能テスト**: 性能、セキュリティ、ユーザビリティ
- **回帰テスト**: 変更時の影響確認

## 3. テストケース設計

### 認証機能テスト
| テストケースID | テスト項目 | 入力 | 期待結果 |
|---------------|-----------|------|----------|
| AUTH_001 | 正常ログイン | 有効なユーザー名/パスワード | ログイン成功、トークン発行 |
| AUTH_002 | 無効パスワード | 誤ったパスワード | ログイン失敗、エラーメッセージ |
| AUTH_003 | トークン有効期限 | 有効期限切れトークン | 自動リフレッシュ |
| AUTH_004 | 未認証アクセス | トークンなし | 401エラー |

### 納品書管理テスト
| テストケースID | テスト項目 | 入力 | 期待結果 |
|---------------|-----------|------|----------|
| DN_001 | 画像アップロード | 有効な画像ファイル | アップロード成功 |
| DN_002 | AI認識処理 | 手書き納品書画像 | 正確なデータ抽出 |
| DN_003 | データ編集 | 認識結果の修正 | データ保存成功 |
| DN_004 | PDF生成 | 納品書データ | 正しいPDF出力 |

### 請求書生成テスト
| テストケースID | テスト項目 | 入力 | 期待結果 |
|---------------|-----------|------|----------|
| INV_001 | 販売員請求書生成 | 納品書データ | 正しい割引計算 |
| INV_002 | 委託先請求書生成 | 納品書データ | 正しい割引適用 |
| INV_003 | PDF出力 | 請求書データ | テンプレート準拠 |

### マスタ管理テスト
| テストケースID | テスト項目 | 入力 | 期待結果 |
|---------------|-----------|------|----------|
| MASTER_001 | 商品追加 | 新規商品データ | DB保存成功 |
| MASTER_002 | 販売員編集 | 更新データ | データ更新成功 |
| MASTER_003 | 論理削除 | 削除対象ID | deleted_flag=true |

## 4. テスト環境

### 開発環境
- **単体テスト**: ローカル実行
- **ツール**: Jest (Frontend), pytest (Backend)

### ステージング環境
- **統合テスト**: テスト用デプロイ環境
- **ツール**: Playwright (E2E), k6 (負荷テスト)

### 本番環境
- **スモークテスト**: デプロイ後基本機能確認

## 5. テスト自動化

### CI/CD統合
- **プッシュ時**: 単体テスト自動実行
- **PR時**: 統合テスト実行
- **リリース時**: E2Eテスト実行

### テストスクリプト
```bash
# フロントエンドテスト
npm run test
npm run test:e2e

# バックエンドテスト
pytest tests/
pytest tests/ --cov=app

# パフォーマンステスト
k6 run load_test.js
```

## 6. テストデータ

### マスタデータ
- 販売員: 32名
- 商品: 39品目
- 委託先: 5社
- 税率: 10%
- 割引率: 5段階

### テストデータ生成
- **Faker**: ランダムデータ生成
- **Factory**: テスト用オブジェクト生成
- **Fixture**: 再利用可能なテストデータ

## 7. 品質指標

### カバレッジ目標
- **単体テスト**: 80%以上
- **統合テスト**: 主要フロー100%
- **E2Eテスト**: 主要シナリオ100%

### パフォーマンス基準
- **API応答時間**: 500ms以内
- **ページ読み込み**: 2秒以内
- **画像認識**: 10秒以内

### 成功基準
- **テスト通過率**: 100%
- **カバレッジ**: 目標達成
- **エラー率**: 1%未満

## 8. テスト管理

### テストケース管理
- **ツール**: TestRailまたはGitHub Issues
- **バージョン管理**: Gitでテストコード管理

### バグ管理
- **報告**: GitHub Issues
- **優先度**: Critical, High, Medium, Low
- **ステータス**: Open, In Progress, Resolved, Closed

### レポート
- **日次**: テスト実行結果
- **週次**: カバレッジレポート
- **月次**: 品質指標レポート